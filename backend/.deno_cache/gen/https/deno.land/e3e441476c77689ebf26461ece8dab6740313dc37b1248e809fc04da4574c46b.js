// Copyright 2018-2025 the oak authors. All rights reserved. MIT license.
/**
 * The internal middleware interfaces and abstractions used by oak.
 *
 * Outside of the {@linkcode Middleware} interface, items are not generally
 * used by end users, but {@linkcode compose} can be used for advanced use
 * cases.
 *
 * @module
 */ // deno-lint-ignore-file
/** A type guard that returns true if the value is
 * {@linkcode MiddlewareObject}. */ export function isMiddlewareObject(value) {
  return value && typeof value === "object" && "handleRequest" in value;
}
/** Compose multiple middleware functions into a single middleware function. */ export function compose(middleware) {
  return function composedMiddleware(context, next) {
    let index = -1;
    async function dispatch(i) {
      if (i <= index) {
        throw new Error("next() called multiple times.");
      }
      index = i;
      let m = middleware[i];
      let fn;
      if (typeof m === "function") {
        fn = m;
      } else if (m && typeof m.handleRequest === "function") {
        fn = m.handleRequest.bind(m);
      }
      if (i === middleware.length) {
        fn = next;
      }
      if (!fn) {
        return;
      }
      await fn(context, dispatch.bind(null, i + 1));
    }
    return dispatch(0);
  };
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImh0dHBzOi8vZGVuby5sYW5kL3gvb2FrQHYxNy4xLjYvbWlkZGxld2FyZS50cyJdLCJzb3VyY2VzQ29udGVudCI6WyIvLyBDb3B5cmlnaHQgMjAxOC0yMDI1IHRoZSBvYWsgYXV0aG9ycy4gQWxsIHJpZ2h0cyByZXNlcnZlZC4gTUlUIGxpY2Vuc2UuXG5cbi8qKlxuICogVGhlIGludGVybmFsIG1pZGRsZXdhcmUgaW50ZXJmYWNlcyBhbmQgYWJzdHJhY3Rpb25zIHVzZWQgYnkgb2FrLlxuICpcbiAqIE91dHNpZGUgb2YgdGhlIHtAbGlua2NvZGUgTWlkZGxld2FyZX0gaW50ZXJmYWNlLCBpdGVtcyBhcmUgbm90IGdlbmVyYWxseVxuICogdXNlZCBieSBlbmQgdXNlcnMsIGJ1dCB7QGxpbmtjb2RlIGNvbXBvc2V9IGNhbiBiZSB1c2VkIGZvciBhZHZhbmNlZCB1c2VcbiAqIGNhc2VzLlxuICpcbiAqIEBtb2R1bGVcbiAqL1xuXG4vLyBkZW5vLWxpbnQtaWdub3JlLWZpbGVcblxuaW1wb3J0IHR5cGUgeyBTdGF0ZSB9IGZyb20gXCIuL2FwcGxpY2F0aW9uLnRzXCI7XG5pbXBvcnQgdHlwZSB7IENvbnRleHQgfSBmcm9tIFwiLi9jb250ZXh0LnRzXCI7XG5cbi8qKiBBIGZ1bmN0aW9uIGZvciBjaGFpbmluZyBtaWRkbGV3YXJlLiAqL1xuZXhwb3J0IHR5cGUgTmV4dCA9ICgpID0+IFByb21pc2U8dW5rbm93bj47XG5cbi8qKiBNaWRkbGV3YXJlIGFyZSBmdW5jdGlvbnMgd2hpY2ggYXJlIGNoYWluZWQgdG9nZXRoZXIgdG8gZGVhbCB3aXRoXG4gKiByZXF1ZXN0cy4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgTWlkZGxld2FyZTxcbiAgUyBleHRlbmRzIFN0YXRlID0gUmVjb3JkPHN0cmluZywgYW55PixcbiAgVCBleHRlbmRzIENvbnRleHQgPSBDb250ZXh0PFM+LFxuPiB7XG4gIChjb250ZXh0OiBULCBuZXh0OiBOZXh0KTogUHJvbWlzZTx1bmtub3duPiB8IHVua25vd247XG59XG5cbi8qKiBNaWRkbGV3YXJlIG9iamVjdHMgYWxsb3cgZW5jYXBzdWxhdGlvbiBvZiBtaWRkbGV3YXJlIGFsb25nIHdpdGggdGhlIGFiaWxpdHlcbiAqIHRvIGluaXRpYWxpemUgdGhlIG1pZGRsZXdhcmUgdXBvbiBsaXN0ZW4uICovXG5leHBvcnQgaW50ZXJmYWNlIE1pZGRsZXdhcmVPYmplY3Q8XG4gIFMgZXh0ZW5kcyBTdGF0ZSA9IFJlY29yZDxzdHJpbmcsIGFueT4sXG4gIFQgZXh0ZW5kcyBDb250ZXh0PFM+ID0gQ29udGV4dDxTPixcbj4ge1xuICAvKiogT3B0aW9uYWwgZnVuY3Rpb24gZm9yIGRlbGF5ZWQgaW5pdGlhbGl6YXRpb24gd2hpY2ggd2lsbCBiZSBjYWxsZWQgd2hlblxuICAgKiB0aGUgYXBwbGljYXRpb24gc3RhcnRzIGxpc3RlbmluZy4gKi9cbiAgaW5pdD86ICgpID0+IFByb21pc2U8dW5rbm93bj4gfCB1bmtub3duO1xuICAvKiogVGhlIG1ldGhvZCB0byBiZSBjYWxsZWQgdG8gaGFuZGxlIHRoZSByZXF1ZXN0LiAqL1xuICBoYW5kbGVSZXF1ZXN0KGNvbnRleHQ6IFQsIG5leHQ6IE5leHQpOiBQcm9taXNlPHVua25vd24+IHwgdW5rbm93bjtcbn1cblxuLyoqIFR5cGUgdGhhdCByZXByZXNlbnRzIHtAbGlua2NvZGUgTWlkZGxld2FyZX0gb3JcbiAqIHtAbGlua2NvZGUgTWlkZGxld2FyZU9iamVjdH0uICovXG5leHBvcnQgdHlwZSBNaWRkbGV3YXJlT3JNaWRkbGV3YXJlT2JqZWN0PFxuICBTIGV4dGVuZHMgU3RhdGUgPSBSZWNvcmQ8c3RyaW5nLCBhbnk+LFxuICBUIGV4dGVuZHMgQ29udGV4dCA9IENvbnRleHQ8Uz4sXG4+ID0gTWlkZGxld2FyZTxTLCBUPiB8IE1pZGRsZXdhcmVPYmplY3Q8UywgVD47XG5cbi8qKiBBIHR5cGUgZ3VhcmQgdGhhdCByZXR1cm5zIHRydWUgaWYgdGhlIHZhbHVlIGlzXG4gKiB7QGxpbmtjb2RlIE1pZGRsZXdhcmVPYmplY3R9LiAqL1xuZXhwb3J0IGZ1bmN0aW9uIGlzTWlkZGxld2FyZU9iamVjdDxcbiAgUyBleHRlbmRzIFN0YXRlID0gUmVjb3JkPHN0cmluZywgYW55PixcbiAgVCBleHRlbmRzIENvbnRleHQgPSBDb250ZXh0PFM+LFxuPih2YWx1ZTogTWlkZGxld2FyZU9yTWlkZGxld2FyZU9iamVjdDxTLCBUPik6IHZhbHVlIGlzIE1pZGRsZXdhcmVPYmplY3Q8UywgVD4ge1xuICByZXR1cm4gdmFsdWUgJiYgdHlwZW9mIHZhbHVlID09PSBcIm9iamVjdFwiICYmIFwiaGFuZGxlUmVxdWVzdFwiIGluIHZhbHVlO1xufVxuXG4vKiogQ29tcG9zZSBtdWx0aXBsZSBtaWRkbGV3YXJlIGZ1bmN0aW9ucyBpbnRvIGEgc2luZ2xlIG1pZGRsZXdhcmUgZnVuY3Rpb24uICovXG5leHBvcnQgZnVuY3Rpb24gY29tcG9zZTxcbiAgUyBleHRlbmRzIFN0YXRlID0gUmVjb3JkPHN0cmluZywgYW55PixcbiAgVCBleHRlbmRzIENvbnRleHQgPSBDb250ZXh0PFM+LFxuPihcbiAgbWlkZGxld2FyZTogTWlkZGxld2FyZU9yTWlkZGxld2FyZU9iamVjdDxTLCBUPltdLFxuKTogKGNvbnRleHQ6IFQsIG5leHQ/OiBOZXh0KSA9PiBQcm9taXNlPHVua25vd24+IHtcbiAgcmV0dXJuIGZ1bmN0aW9uIGNvbXBvc2VkTWlkZGxld2FyZShcbiAgICBjb250ZXh0OiBULFxuICAgIG5leHQ/OiBOZXh0LFxuICApOiBQcm9taXNlPHVua25vd24+IHtcbiAgICBsZXQgaW5kZXggPSAtMTtcblxuICAgIGFzeW5jIGZ1bmN0aW9uIGRpc3BhdGNoKGk6IG51bWJlcik6IFByb21pc2U8dm9pZD4ge1xuICAgICAgaWYgKGkgPD0gaW5kZXgpIHtcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwibmV4dCgpIGNhbGxlZCBtdWx0aXBsZSB0aW1lcy5cIik7XG4gICAgICB9XG4gICAgICBpbmRleCA9IGk7XG4gICAgICBsZXQgbTogTWlkZGxld2FyZU9yTWlkZGxld2FyZU9iamVjdDxTLCBUPiB8IHVuZGVmaW5lZCA9IG1pZGRsZXdhcmVbaV07XG4gICAgICBsZXQgZm46IE1pZGRsZXdhcmU8UywgVD4gfCB1bmRlZmluZWQ7XG4gICAgICBpZiAodHlwZW9mIG0gPT09IFwiZnVuY3Rpb25cIikge1xuICAgICAgICBmbiA9IG07XG4gICAgICB9IGVsc2UgaWYgKG0gJiYgdHlwZW9mIG0uaGFuZGxlUmVxdWVzdCA9PT0gXCJmdW5jdGlvblwiKSB7XG4gICAgICAgIGZuID0gKG0gYXMgTWlkZGxld2FyZU9iamVjdCkuaGFuZGxlUmVxdWVzdC5iaW5kKG0pO1xuICAgICAgfVxuICAgICAgaWYgKGkgPT09IG1pZGRsZXdhcmUubGVuZ3RoKSB7XG4gICAgICAgIGZuID0gbmV4dDtcbiAgICAgIH1cbiAgICAgIGlmICghZm4pIHtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgICAgYXdhaXQgZm4oY29udGV4dCwgZGlzcGF0Y2guYmluZChudWxsLCBpICsgMSkpO1xuICAgIH1cblxuICAgIHJldHVybiBkaXNwYXRjaCgwKTtcbiAgfTtcbn1cbiJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSx5RUFBeUU7QUFFekU7Ozs7Ozs7O0NBUUMsR0FFRCx3QkFBd0I7QUFxQ3hCO2lDQUNpQyxHQUNqQyxPQUFPLFNBQVMsbUJBR2QsS0FBeUM7RUFDekMsT0FBTyxTQUFTLE9BQU8sVUFBVSxZQUFZLG1CQUFtQjtBQUNsRTtBQUVBLDZFQUE2RSxHQUM3RSxPQUFPLFNBQVMsUUFJZCxVQUFnRDtFQUVoRCxPQUFPLFNBQVMsbUJBQ2QsT0FBVSxFQUNWLElBQVc7SUFFWCxJQUFJLFFBQVEsQ0FBQztJQUViLGVBQWUsU0FBUyxDQUFTO01BQy9CLElBQUksS0FBSyxPQUFPO1FBQ2QsTUFBTSxJQUFJLE1BQU07TUFDbEI7TUFDQSxRQUFRO01BQ1IsSUFBSSxJQUFvRCxVQUFVLENBQUMsRUFBRTtNQUNyRSxJQUFJO01BQ0osSUFBSSxPQUFPLE1BQU0sWUFBWTtRQUMzQixLQUFLO01BQ1AsT0FBTyxJQUFJLEtBQUssT0FBTyxFQUFFLGFBQWEsS0FBSyxZQUFZO1FBQ3JELEtBQUssQUFBQyxFQUF1QixhQUFhLENBQUMsSUFBSSxDQUFDO01BQ2xEO01BQ0EsSUFBSSxNQUFNLFdBQVcsTUFBTSxFQUFFO1FBQzNCLEtBQUs7TUFDUDtNQUNBLElBQUksQ0FBQyxJQUFJO1FBQ1A7TUFDRjtNQUNBLE1BQU0sR0FBRyxTQUFTLFNBQVMsSUFBSSxDQUFDLE1BQU0sSUFBSTtJQUM1QztJQUVBLE9BQU8sU0FBUztFQUNsQjtBQUNGIn0=
// denoCacheMetadata=16513538070074205228,11944497677673347832